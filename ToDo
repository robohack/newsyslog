NEWSYSLOG ToDo -- Things that could be fixed/improved/added.

Patches to close any of these items will be gratefully accepted!  Other
suggestions and comments are also encouraged.

- Message-ID: <0c8f01bf2af4$429bd940$eff83b9d@redmond.corp.microsoft.com>
  Date: Tue, 9 Nov 1999 12:51:54 -0800
  From: "James Webster" <James3838@tsi-net.com>
  Subject: Archives not working on Newsyslog
  To: <woods@planix.com>
  
  I've been using your version of newsyslog and have been quite happy with it,
  though I should have watched it more closely.  It appears that the ngen
  option isn't working and that it only archives one days worth of logs.  I
  figured I'd check with you if you knew about it, before digging into to find
  out the problem. [[reported for 1.0.95]]

- fix handling of log file timestamps to take into account timezones.
  Note that the common log format actually includes " {+-}TZOFF" after
  the time, but strptime() doesn't seem to have a way to parse and use
  this value.  Syslog timestamps are in local time, so watch out for
  stupid daylight savings confusion too!

- Add one more optional field:  the format of the turnover message, with
  the default to be the "syslog" style:

	Mar 15 00:00:01 most newsyslog[17295]: logfile turned over

  Nothing fancy though.  Just strftime() formats, plus one magic
  specifier to represent where the hostname goes (%@), and another magic
  specifier for the "newsyslog[17295]: logfile turned over" part (%#).
  (i.e. run the format specifier through a simple replacement editor for
  the two magic strings, and then pass it to strftime()).  The default
  would thus be something like this:

	"%b %d %T %@ %#"

- Reverse the order of operations when checking the age of the log file
  such that the timestamp is always read from the first record of
  non-binary log files using the turnover format as a guide.  Only
  binary files will revert to checking the age of the .0 file.  This
  will make newsyslog less sensitive to the affects of anyone messing
  with the archive copies, and more accurate for the first go-around on
  non-syslog format log files.

  Perhaps this should only be done for files archived at 24hr multiples
  (i.e. '-m'), and in these cases the turnover message should also be
  entered immediately in the new log file too.  This will ensure that
  age determination does not rely on when the daemon writes its first
  log entry.  It may make parsing the first entry easier too.

  One possible limitation here is that the timestamp may have to appear
  at the beginning of the line (with only constant characters before and
  within it).  The only way around this might be to iterate strptime()
  starting at each successive character in the string to try and find a
  parsable date format that matches the turnover format as it would be
  with the two magic strings stripped off.

  For example the standard syslog format "%b %d %T %@ %#" would strip
  down to "%b %d %T ", which would hopefully match at offset 0 into the
  first log entry.

  An HTTP Common Log Format turnover message output format might be:

	"%@ - - [%Y/%m/%d:%T] \"%#\""

  This would have to be stripped down to the following for strptime():

	"%Y/%m/%d:%T] \""

- add support for specifying size and interval units other than KB & hrs.

- think about need to add an optional signal number/name to use other
  than SIGHUP for notifying the log-writing daemon.  FreeBSD added this
  feature in their 1.20 because "F.e. apache restarts less agressively
  on USR1 then on HUP."

- think about adding an optional way to specify a process to be run
  after a given logfile has been rotated.  This could be used to run
  logfile analysis tools, etc.

- think about adding FreeBSD's "when" field:

     when    The when field can consist of an interval, a specific time, or
             both.  If the when field is an asterisk (`*') log rotation will
             depend only on the contents of the size field.  Otherwise, the
             when field consists of an optional interval in hours, optionally
             followed by an `@'-sign and a time in a restricted ISO 8601 for-
             mat.  If a time is specified, the log file will only be trimmed
             if newsyslog is run within one hour of the specified time.  If an
             interval is specified, the log file will be trimmed if that many
             hours have passed since the last rotation.  When both a time and
             an interval are specified, both conditions must be satisfied for
             the rotation to take place.

             The particular format of the time is
             [[[[[cc]yy]mm]dd][T[hh[mm[ss]]]]]. Optional date fields default
             to the appropriate component of the current date; optional time
             fields default to midnight; hence if today is January 22, 1999,
             the following date specifications are all equivalent:

                   `19990122T000000'
                   `990122T000000'
                   `0122T000000'
                   `22T000000'
                   `T000000'
                   `T0000'
                   `T00'
                   `22T'
                   `T'
                   `'

             There is no provision for specification of a timezone.  There is
             little point in specifying an explicit minutes or seconds compo-
             nent in the current implementation, since the only comparison is
             `within the hour'.


#ident	"@(#)newsyslog:$Name:  $:$Id: ToDo,v 1.6 2000/07/07 17:29:41 woods Exp $"
